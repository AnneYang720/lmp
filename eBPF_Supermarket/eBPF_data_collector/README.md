# BPF 数据收集/导出器

该项目是 LMP 下 eBPF_Visualization 项目的一部分，仅做数据收集/导出。

这是一个 BPF 数据收集/导出的轻量级命令行工具，仅依赖 sqlite3，只需按照简单的格式规范就可以轻松地将提取出的数据导出成 csv 格式文件。


## 环境配置：
```bash
$ sudo apt install sqlite3 libsqlite3-dev
```

## 简单的格式要求：
第一行输出指标名称，格式为 `指标名|指标数据类型`，可选的指标数据类型有：

| **带符号的整数** | **浮点数** | **文本字符串** |
|---------|------|------|
| INTEGER | REAL | TEXT |

之后的每一行输出数据即可，按照空格分隔(空格个数不限)，例如：
```text
TIME|TEXT   READ_s|INTEGER  WRITE_s|INTEGER  CREATE_s|INTEGER  OPEN_s|INTEGER  FSYNC_s|INTEGER
21:03:33:      1387              182                 0              72                0
21:03:34:       146              128                 0              61                0
21:03:35:       166              179                 0             123                0
21:03:36:       144              125                 0              61                0
21:03:37:       147              130                 0              61                0
21:03:38:       160              130                 0              66                0
21:03:39:       356              270                 0              68                0
21:03:40:       145              129                 0              60                0
```
注意，指标名称按照 sqlite3 命名规范：
- 使用小写英文字母、数字、下划线命名
- 数据类型使用大写英文字母

## 使用方法:
```bash
$ make
$ sudo ./lmp -h    # 列出帮助信息
$ sudo ./lmp collect {YOUR_EBPF_PROGRAM}   # 收集 {YOUR_EBPF_PROGRAM_PATH} 程序提取出的数据
```
程序会自动将输出的数据保存至 sqlite3 数据库，表名采用的是你的 `BPF文件名称` 并在 `ctrl c` 之后生成以 `表名+时间.csv` 命名的文件,可以直接使用。

## TODO
- 将生成的 `csv文件` 的 uid、gid 改为普通用户，需要指定用户
- 增加上层功能：查看数据库中已经存在了哪些表
- 增加导出指定表的数据为csv格式功能
- 增加是否在命令行输出选项